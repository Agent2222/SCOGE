import{Z as m}from"./index-BvGAAEqy.js";import{bh as d,bD as y,cc as u,ck as f,bV as g,bm as c,ct as l}from"./main-CjiS4ifE.js";import"./random-Db2hH_qc.js";import"./wScoge-BthgsBuw.js";const h=0n;async function b({account:a,serializableTransaction:e,transaction:s,gasless:n}){const o=u({address:n.relayerForwarderAddress,chain:s.chain,client:s.client}),r=await f({contract:o,method:"function getNonce(address,uint256) view returns (uint256)",params:[a.address,h]}),i=Math.floor(Date.now()/1e3)+(n.deadlineSeconds??3600),t={from:a.address,to:e.to,token:m,txGas:e.gas,tokenGasPrice:0n,batchId:h,batchNonce:r,deadline:i,data:e.data};if(!t.to)throw new Error("Cannot send a transaction without a `to` address");if(!t.txGas)throw new Error("Cannot send a transaction without a `gas` value");if(!t.data)throw new Error("Cannot send a transaction without a `data` value");const p=g([{type:"address"},{type:"address"},{type:"address"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"bytes32"}],[c(t.from),c(t.to),c(t.token),t.txGas,t.tokenGasPrice,t.batchId,t.batchNonce,l(t.data)]),w=await a.signMessage({message:p});return[t,w]}async function G(a){var i;const[e,s]=await b(a),n=await fetch("https://api.biconomy.io/api/v2/meta-tx/native",{method:"POST",body:d({apiId:a.gasless.apiId,params:[e,s],from:e.from,to:e.to,gasLimit:e.txGas}),headers:{"x-api-key":a.gasless.apiKey,"Content-Type":"application/json;charset=utf-8"}});if(!n.ok)throw(i=n.body)==null||i.cancel(),new Error(`Failed to send transaction: ${await n.text()}`);const o=await n.json(),r=o.txHash;if(y(r))return{transactionHash:r,chain:a.transaction.chain,client:a.transaction.client};throw new Error(`Failed to send transaction: ${d(o)}`)}export{b as prepareBiconomyTransaction,G as relayBiconomyTransaction};
