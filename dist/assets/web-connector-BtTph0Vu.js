import{F as _,G as y,H as G,d as B,I as M,p as $}from"./main-CH2F13Ml.js";import{A as V,U as m,o as K}from"./type-3H5uNriJ.js";import"./wScoge-z36Oeizf.js";async function F(r,e){return await r({method:"eth_sendRawTransaction",params:[e]})}const H="/sdk/2022-08-12/embedded-wallet",I=r=>`thirdwebEwsWalletUserId-${r}`,Q="walletToken",b=r=>`${Q}-${r}`,S=r=>`passkey-credential-id-${r}`,q="a",L=(r,e)=>`${q}-${r}-${e}`,T=r=>`walletConnectSessions-${r}`,P=new Map;class f{constructor({clientId:e,ecosystemId:t}){Object.defineProperty(this,"isSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"key",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isSupported=typeof window<"u"&&!!window.localStorage,this.key=x(e,t)}async getItem(e){return this.isSupported?window.localStorage.getItem(e):P.get(e)??null}async setItem(e,t){if(this.isSupported)return window.localStorage.setItem(e,t);P.set(e,t)}async removeItem(e){const t=await this.getItem(e);return this.isSupported&&t?(window.localStorage.removeItem(e),!0):!1}async getWalletConnectSessions(){return this.getItem(T(this.key))}async saveWalletConnectSessions(e){await this.setItem(T(this.key),e)}async savePasskeyCredentialId(e){await this.setItem(S(this.key),e)}async getPasskeyCredentialId(){return this.getItem(S(this.key))}async saveAuthCookie(e){await this.setItem(b(this.key),e)}async getAuthCookie(){return this.getItem(b(this.key))}async removeAuthCookie(){return this.removeItem(b(this.key))}async saveDeviceShare(e,t){await this.saveWalletUserId(t),await this.setItem(L(this.key,t),e)}async getDeviceShare(){const e=await this.getWalletUserId();return e?this.getItem(L(this.key,e)):null}async removeDeviceShare(){const e=await this.getWalletUserId();return e?this.removeItem(L(this.key,e)):!1}async getWalletUserId(){return this.getItem(I(this.key))}async saveWalletUserId(e){await this.setItem(I(this.key),e)}async removeWalletUserId(){return this.removeItem(I(this.key))}}const x=(r,e)=>`${r}${e?`-${e}`:""}`;function v(r){return new Promise(e=>{setTimeout(e,r*1e3)})}const J={height:"100%",width:"100%",border:"none",backgroundColor:"transparent",colorScheme:"light",position:"fixed",top:"0px",right:"0px",zIndex:"2147483646",display:"none"},E=new Map;class Z{constructor({link:e,baseUrl:t,iframeId:a,container:i=document.body,onIframeInitialize:n}){Object.defineProperty(this,"iframe",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"POLLING_INTERVAL_SECONDS",{enumerable:!0,configurable:!0,writable:!0,value:1.4}),Object.defineProperty(this,"iframeBaseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.iframeBaseUrl=t;let s=document.getElementById(a);const c=new URL(e);if(!s||s.src!==c.href){s=document.createElement("iframe");const u={...J};Object.assign(s.style,u),s.setAttribute("id",a),s.setAttribute("fetchpriority","high"),i.appendChild(s),s.src=c.href;const g=h=>{if(h.data.eventType==="ewsIframeLoaded"){if(window.removeEventListener("message",g),!s){console.warn("thirdweb iFrame not found");return}this.onIframeLoadHandler(s,n)()}};window.addEventListener("message",g)}this.iframe=s}async onIframeLoadedInitVariables(){return{}}onIframeLoadHandler(e,t){return async()=>{var s;const a=new MessageChannel,i=new Promise((c,u)=>{a.port1.onmessage=g=>{const{data:h}=g;a.port1.close(),h.success||u(new Error(h.error)),E.set(e.src,!0),t&&t(),c(!0)}});(s=e==null?void 0:e.contentWindow)==null||s.postMessage({eventType:"initIframe",data:await this.onIframeLoadedInitVariables()},this.iframeBaseUrl,[a.port2]),await i}}async call({procedureName:e,params:t,showIframe:a=!1}){var s;for(;!E.get(this.iframe.src);)await v(this.POLLING_INTERVAL_SECONDS);a&&(this.iframe.style.display="block",await v(.005));const i=new MessageChannel,n=new Promise((c,u)=>{i.port1.onmessage=async g=>{const{data:h}=g;i.port1.close(),a&&(await v(.1),this.iframe.style.display="none"),h.success?c(h.data):u(new Error(h.error))}});return(s=this.iframe.contentWindow)==null||s.postMessage({eventType:e,data:t},this.iframeBaseUrl,[i.port2]),n}destroy(){E.delete(this.iframe.src)}}class z extends Z{constructor({clientId:e,baseUrl:t,ecosystem:a}){super({iframeId:Y+((a==null?void 0:a.id)||""),link:X({clientId:e,path:H,ecosystem:a,baseUrl:t}).href,baseUrl:t,container:document.body}),Object.defineProperty(this,"clientId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.clientId=e,this.ecosystem=a}async onIframeLoadedInitVariables(){var t,a,i;const e=new f({clientId:this.clientId,ecosystemId:(t=this.ecosystem)==null?void 0:t.id});return{authCookie:await e.getAuthCookie(),deviceShareStored:await e.getDeviceShare(),walletUserId:await e.getWalletUserId(),clientId:this.clientId,partnerId:(a=this.ecosystem)==null?void 0:a.partnerId,ecosystemId:(i=this.ecosystem)==null?void 0:i.id}}}function X({clientId:r,baseUrl:e,path:t,ecosystem:a,queryParams:i}){var s;const n=new URL(`${t}`,e);if(i)for(const c of Object.keys(i))n.searchParams.set(c,((s=i[c])==null?void 0:s.toString())||"");return n.searchParams.set("clientId",r),(a==null?void 0:a.partnerId)!==void 0&&n.searchParams.set("partnerId",a.partnerId),(a==null?void 0:a.id)!==void 0&&n.searchParams.set("ecosystemId",a.id),n}const Y="thirdweb-in-app-wallet-iframe";class ee{constructor({baseUrl:e,querier:t,preLogin:a,postLogin:i,client:n,ecosystem:s}){Object.defineProperty(this,"LoginQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"preLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseUrl=e,this.LoginQuerier=t,this.preLogin=a,this.postLogin=i,this.client=n,this.ecosystem=s}async sendEmailLoginOtp({email:e}){return await this.preLogin(),await this.LoginQuerier.call({procedureName:"sendThirdwebEmailLoginOtp",params:{email:e}})}async sendSmsLoginOtp({phoneNumber:e}){return await this.preLogin(),await this.LoginQuerier.call({procedureName:"sendThirdwebSmsLoginOtp",params:{phoneNumber:e}})}}class te extends ee{constructor(){super(...arguments),Object.defineProperty(this,"closeWindow",{enumerable:!0,configurable:!0,writable:!0,value:({isWindowOpenedByFn:e,win:t,closeOpenedWindow:a})=>{e?t==null||t.close():t&&a?a(t):t&&t.close()}})}async getOauthLoginUrl(e){try{return await this.LoginQuerier.call({procedureName:"getHeadlessOauthLoginLink",params:{authProvider:e}})}catch(t){throw console.error(t),t}}async loginWithModal(){await this.preLogin();const e=await this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:void 0,showIframe:!0});return this.postLogin(e)}async loginWithEmailOtp({email:e}){await this.preLogin();const t=await this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:{email:e},showIframe:!0});return this.postLogin(t)}getOauthPopUpSizing(e){switch(e){case V.FACEBOOK:return"width=715, height=555";default:return"width=350, height=500"}}async loginWithOauth(e){let t=e==null?void 0:e.openedWindow,a=!1;if(t||(t=window.open("","Login",this.getOauthPopUpSizing(e.oauthProvider)),a=!0),!t)throw new Error("Something went wrong opening pop-up");const[{loginLink:i}]=await Promise.all([this.getOauthLoginUrl(e.oauthProvider),this.preLogin()]);t.location.href=i;const n=await new Promise((s,c)=>{const u=window.setInterval(async()=>{t&&t.closed&&(clearInterval(u),window.removeEventListener("message",g),c(new Error("User closed login window")))},1e3),g=async h=>{var o,l;if(h.origin===this.baseUrl){if(typeof h.data!="object"){c(new Error("Invalid event data"));return}switch(h.data.eventType){case"userLoginSuccess":{window.removeEventListener("message",g),clearInterval(u),this.closeWindow({isWindowOpenedByFn:a,win:t,closeOpenedWindow:e==null?void 0:e.closeOpenedWindow}),h.data.authResult&&s(h.data.authResult);break}case"userLoginFailed":{window.removeEventListener("message",g),clearInterval(u),this.closeWindow({isWindowOpenedByFn:a,win:t,closeOpenedWindow:e==null?void 0:e.closeOpenedWindow}),c(new Error(h.data.error));break}case"injectDeveloperClientId":{t==null||t.postMessage({eventType:"injectDeveloperClientIdResult",developerClientId:this.client.clientId,authOption:e.oauthProvider,partnerId:(o=this.ecosystem)==null?void 0:o.partnerId,ecosystemId:(l=this.ecosystem)==null?void 0:l.id},this.baseUrl);break}}}};window.addEventListener("message",g)});return this.postLogin({storedToken:{...n.storedToken,shouldStoreCookieString:!0},walletDetails:{...n.walletDetails,isIframeStorageEnabled:!1}})}async loginWithCustomJwt({encryptionKey:e,jwt:t}){await this.preLogin();const a=await this.LoginQuerier.call({procedureName:"loginWithCustomJwt",params:{encryptionKey:e,jwt:t}});return this.postLogin(a)}async loginWithCustomAuthEndpoint({encryptionKey:e,payload:t}){await this.preLogin();const a=await this.LoginQuerier.call({procedureName:"loginWithCustomAuthEndpoint",params:{encryptionKey:e,payload:t}});return this.postLogin(a)}async verifyEmailLoginOtp({email:e,otp:t,recoveryCode:a}){const i=await this.LoginQuerier.call({procedureName:"verifyThirdwebEmailLoginOtp",params:{email:e,otp:t,recoveryCode:a}});return this.postLogin(i)}async verifySmsLoginOtp({phoneNumber:e,otp:t,recoveryCode:a}){const i=await this.LoginQuerier.call({procedureName:"verifyThirdwebSmsLoginOtp",params:{phoneNumber:e,otp:t,recoveryCode:a}});return this.postLogin(i)}}class re{constructor({client:e,querier:t,onAuthSuccess:a,ecosystem:i,baseUrl:n}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"AuthQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAuthSuccess",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BaseLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.AuthQuerier=t,this.localStorage=new f({clientId:e.clientId,ecosystemId:i==null?void 0:i.id}),this.onAuthSuccess=a,this.BaseLogin=new te({postLogin:async s=>this.postLogin(s),preLogin:async()=>{await this.preLogin()},ecosystem:i,querier:t,client:e,baseUrl:n})}async preLogin(){await this.logout()}async postLogin({storedToken:e,walletDetails:t}){return e.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(e.cookieString),await this.onAuthSuccess({storedToken:e,walletDetails:t})}async loginWithAuthToken(e,t){await this.preLogin();const a=await this.AuthQuerier.call({procedureName:"loginWithStoredTokenDetails",params:{storedToken:e.storedToken,recoveryCode:t}});return this.postLogin(a)}async loginWithModal(){return this.BaseLogin.loginWithModal()}async loginWithEmailOtp(e){return this.BaseLogin.loginWithEmailOtp(e)}async loginWithCustomJwt(e){return this.BaseLogin.loginWithCustomJwt(e)}async loginWithCustomAuthEndpoint(e){return this.BaseLogin.loginWithCustomAuthEndpoint(e)}async loginWithOauth(e){return this.BaseLogin.loginWithOauth(e)}async sendEmailLoginOtp({email:e}){return this.BaseLogin.sendEmailLoginOtp({email:e})}async sendSmsLoginOtp({phoneNumber:e}){return this.BaseLogin.sendSmsLoginOtp({phoneNumber:e})}async verifyEmailLoginOtp(e){return this.BaseLogin.verifyEmailLoginOtp(e)}async verifySmsLoginOtp(e){return this.BaseLogin.verifySmsLoginOtp(e)}async logout(){const{success:e}=await this.AuthQuerier.call({procedureName:"logout",params:void 0}),t=await this.localStorage.removeAuthCookie(),a=await this.localStorage.removeWalletUserId();return{success:e||t||a}}}function C(r){return Uint8Array.from(r,e=>e.charCodeAt(0)).buffer}function ae(r){return String.fromCharCode(...new Uint8Array(r))}function N(r){return r.match(/^[a-zA-Z0-9\-_]+=*$/)!==null}function p(r){return btoa(ae(r)).replaceAll("+","-").replaceAll("/","_")}function O(r){return r=r.replaceAll("-","+").replaceAll("_","/"),C(atob(r))}async function ie(r){return await crypto.subtle.digest("SHA-256",r)}function k(){return!!window.PublicKeyCredential}async function D(){return await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}async function ne(r){if(r==="local")return"platform";if(r==="roaming"||r==="extern")return"cross-platform";if(r!=="both")try{return await D()?"platform":"cross-platform"}catch{return}}function se(r){switch(r){case-7:return"ES256";case-257:return"RS256";default:throw new Error(`Unknown algorithm code: ${r}`)}}async function oe(r,e,t){if(t=t??{},!N(e))throw new Error("Provided challenge is not properly encoded in Base64url");const a={challenge:O(e),rp:{id:t.domain??window.location.hostname,name:t.domain??window.location.hostname},user:{id:t.userHandle?C(t.userHandle):await ie(new TextEncoder().encode("passwordless.id-user:"+r)),name:r,displayName:r},pubKeyCredParams:[{alg:-7,type:"public-key"},{alg:-257,type:"public-key"}],timeout:t.timeout??6e4,authenticatorSelection:{userVerification:t.userVerification??"required",authenticatorAttachment:await ne(t.authenticatorType??"auto"),residentKey:t.discoverable??"preferred",requireResidentKey:t.discoverable==="required"},attestation:"direct"};t.debug&&console.debug(a);const i=await navigator.credentials.create({publicKey:a});t.debug&&console.debug(i);const n=i.response;let s={username:r,credential:{id:i.id,publicKey:p(n.getPublicKey()),algorithm:se(i.response.getPublicKeyAlgorithm())},authenticatorData:p(n.getAuthenticatorData()),clientData:p(n.clientDataJSON)};return t.attestation&&(s.attestationData=p(n.attestationObject)),s}async function le(r){const e=["internal"],t=["hybrid","usb","ble","nfc"];if(r==="local")return e;if(r=="roaming"||r==="extern")return t;if(r==="both")return[...e,...t];try{return await D()?e:t}catch{return[...e,...t]}}async function ce(r,e,t){if(t=t??{},!N(e))throw new Error("Provided challenge is not properly encoded in Base64url");const a=await le(t.authenticatorType??"auto");let i={challenge:O(e),rpId:t.domain??window.location.hostname,allowCredentials:r.map(u=>({id:O(u),type:"public-key",transports:a})),userVerification:t.userVerification??"required",timeout:t.timeout??6e4};t.debug&&console.debug(i);let n=await navigator.credentials.get({publicKey:i,mediation:t.mediation});t.debug&&console.debug(n);const s=n.response;return{credentialId:n.id,authenticatorData:p(s.authenticatorData),clientData:p(s.clientDataJSON),signature:p(s.signature),userHandle:s.userHandle?p(s.userHandle):void 0}}new TextDecoder("utf-8");function U(){return`${y("inAppWallet")}/api/2024-05-05/login/passkey/callback`}function j(r,e){return`${y("inAppWallet")}/api/2024-05-05/login/passkey?type=${r}${e?`&username=${e}`:""}`}async function ue(r){var o,l,d;if(!k())throw new Error("Passkeys are not available on this device");const e=new f({clientId:r.client.clientId,ecosystemId:(o=r.ecosystem)==null?void 0:o.id}),t=_(r.client,r.ecosystem),a=r.username??he(r.ecosystem),n=await(await t(j("sign-up",a))).json();if(!n.challenge)throw new Error("No challenge received");const s=n.challenge,c=await oe(a,s,{authenticatorType:r.authenticatorType??"auto",userVerification:"required",attestation:!0,debug:!1});await e.savePasskeyCredentialId(c.credential.id);const u={};(l=r.ecosystem)!=null&&l.partnerId&&(u["x-ecosystem-partner-id"]=r.ecosystem.partnerId),(d=r.ecosystem)!=null&&d.id&&(u["x-ecosystem-id"]=r.ecosystem.id);const h=await(await t(U(),{method:"POST",headers:{"Content-Type":"application/json",...u},body:JSON.stringify({type:"sign-up",authenticatorData:c.authenticatorData,credentialId:c.credential.id,serverVerificationId:n.serverVerificationId,clientData:c.clientData,username:a,credential:{publicKey:c.credential.publicKey,algorithm:c.credential.algorithm}})})).json();if(!h)throw new Error("No token received");return h}async function de(r){var l,d,w;if(!k())throw new Error("Passkeys are not available on this device");const e=new f({clientId:r.client.clientId,ecosystemId:(l=r.ecosystem)==null?void 0:l.id}),t=_(r.client,r.ecosystem),i=await(await t(j("sign-in"))).json();if(!i.challenge)throw new Error("No challenge received");const n=i.challenge,s=await e.getPasskeyCredentialId(),u=await ce(s?[s]:[],n,{authenticatorType:r.authenticatorType??"auto",userVerification:"required"}),g={};(d=r.ecosystem)!=null&&d.partnerId&&(g["x-ecosystem-partner-id"]=r.ecosystem.partnerId),(w=r.ecosystem)!=null&&w.id&&(g["x-ecosystem-id"]=r.ecosystem.id);const h=await t(U(),{method:"POST",headers:{"Content-Type":"application/json",...g},body:JSON.stringify({type:"sign-in",authenticatorData:u.authenticatorData,credentialId:u.credentialId,serverVerificationId:i.serverVerificationId,clientData:u.clientData,signature:u.signature})});await e.savePasskeyCredentialId(u.credentialId);const o=await h.json();if(!o)throw new Error("No token received");return o}function he(r){return`${(r==null?void 0:r.id)??"wallet"}-${new Date().toISOString()}`}const ge=async(r,e)=>await(await fetch(`${y("inAppWallet")}/api/2024-05-05/ecosystem-wallet/${r}/partner/${e}`,{headers:{"x-ecosystem-id":r,"x-ecosystem-partner-id":e||""}})).json();class pe{constructor({client:e,ecosystem:t,querier:a}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"walletManagerQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.ecosystem=t,this.walletManagerQuerier=a,this.localStorage=new f({clientId:e.clientId,ecosystemId:t==null?void 0:t.id})}async postWalletSetUp({deviceShareStored:e,walletAddress:t,isIframeStorageEnabled:a,walletUserId:i}){return a||await this.localStorage.saveDeviceShare(e,i),{walletAddress:t}}async getUserWalletStatus(){const e=await this.walletManagerQuerier.call({procedureName:"getUserStatus",params:void 0});return e.status===m.LOGGED_IN_WALLET_INITIALIZED?{status:m.LOGGED_IN_WALLET_INITIALIZED,...e.user,account:await this.getAccount()}:e.status===m.LOGGED_IN_NEW_DEVICE?{status:m.LOGGED_IN_WALLET_UNINITIALIZED,...e.user}:e.status===m.LOGGED_IN_WALLET_UNINITIALIZED?{status:m.LOGGED_IN_WALLET_UNINITIALIZED,...e.user}:{status:e.status}}async getAccount(){var u,g,h;const e=this.walletManagerQuerier,t=this.client,a=(u=this.ecosystem)==null?void 0:u.partnerId,i=!!this.ecosystem,n=(g=this.ecosystem)!=null&&g.partnerId?await ge(this.ecosystem.id,(h=this.ecosystem)==null?void 0:h.partnerId):void 0,{address:s}=await e.call({procedureName:"getAddress",params:void 0}),c=async o=>{const l={to:o.to??void 0,data:o.data,value:o.value,gasLimit:o.gas,nonce:o.nonce,chainId:o.chainId};o.maxFeePerGas?(l.accessList=o.accessList,l.maxFeePerGas=o.maxFeePerGas,l.maxPriorityFeePerGas=o.maxPriorityFeePerGas,l.type=2):(l.gasPrice=o.gasPrice,l.type=0);const{signedTransaction:d}=await e.call({procedureName:"signTransaction",params:{transaction:l,chainId:o.chainId,partnerId:a,rpcEndpoint:`https://${o.chainId}.rpc.thirdweb.com`},showIframe:n!=null&&n.permissions.includes("FULL_CONTROL_V1")?!1:i});return d};return{address:s,async signTransaction(o){if(!o.chainId)throw new Error("chainId required in tx to sign");return c({...o,chainId:o.chainId})},async sendTransaction(o){const l=G({client:t,chain:B(o.chainId)}),d=await c(o);return{transactionHash:await F(l,d)}},async signMessage({message:o}){const l=typeof o=="string"?o:o.raw instanceof Uint8Array?o.raw:M(o.raw),{signedMessage:d}=await e.call({procedureName:"signMessage",params:{message:l,partnerId:a,chainId:1},showIframe:n!=null&&n.permissions.includes("FULL_CONTROL_V1")?!1:i});return d},async signTypedData(o){var A;const l=$(o);(A=l.types)!=null&&A.EIP712Domain&&(l.types.EIP712Domain=void 0);const d=l.domain,w=(d==null?void 0:d.chainId)||1,{signedTypedData:R}=await e.call({procedureName:"signTypedDataV4",params:{domain:{chainId:w,verifyingContract:d==null?void 0:d.verifyingContract,name:d==null?void 0:d.name,version:d==null?void 0:d.version},types:l.types,message:l.message,chainId:w,partnerId:a,rpcEndpoint:`https://${w}.rpc.thirdweb.com`},showIframe:n!=null&&n.permissions.includes("FULL_CONTROL_V1")?!1:i});return R}}}}class ye{isClientIdLegacyPaper(e){return e.indexOf("-")>0&&e.length===36}constructor({client:e,onAuthSuccess:t,ecosystem:a}){if(Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"querier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wallet",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isClientIdLegacyPaper(e.clientId))throw new Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");const i=y("inAppWallet");this.client=e,this.querier=new z({clientId:e.clientId,ecosystem:a,baseUrl:i}),this.wallet=new pe({client:e,ecosystem:a,querier:this.querier}),this.auth=new re({client:e,querier:this.querier,baseUrl:i,ecosystem:a,onAuthSuccess:async n=>(t==null||t(n),await this.wallet.postWalletSetUp({...n.walletDetails,walletUserId:n.storedToken.authDetails.userWalletId}),await this.querier.call({procedureName:"initIframe",params:{partnerId:a==null?void 0:a.partnerId,ecosystemId:a==null?void 0:a.id,deviceShareStored:n.walletDetails.deviceShareStored,clientId:this.client.clientId,walletUserId:n.storedToken.authDetails.userWalletId,authCookie:n.storedToken.cookieString}}),{user:{status:m.LOGGED_IN_WALLET_INITIALIZED,authDetails:n.storedToken.authDetails,account:await this.wallet.getAccount(),walletAddress:n.walletDetails.walletAddress}})})}async getUser(){return this.wallet.getUserWalletStatus()}getAccount(){return this.wallet.getAccount()}async preAuthenticate(e){const t=e.strategy;switch(t){case"email":return this.auth.sendEmailLoginOtp({email:e.email});case"phone":return this.auth.sendSmsLoginOtp({phoneNumber:e.phoneNumber});default:W(t,`Provider: ${t} doesn't require pre-authentication`)}}async authenticate(e){const t=e.strategy;switch(t){case"email":return await this.auth.verifyEmailLoginOtp({email:e.email,otp:e.verificationCode});case"phone":return await this.auth.verifySmsLoginOtp({otp:e.verificationCode,phoneNumber:e.phoneNumber});case"apple":case"facebook":case"google":{const a=K[t];return this.auth.loginWithOauth({oauthProvider:a,closeOpenedWindow:e.closeOpenedWindow,openedWindow:e.openedWindow})}case"jwt":return this.auth.loginWithCustomJwt({jwt:e.jwt,encryptionKey:e.encryptionKey});case"auth_endpoint":return this.auth.loginWithCustomAuthEndpoint({payload:e.payload,encryptionKey:e.encryptionKey});case"iframe_email_verification":return this.auth.loginWithEmailOtp({email:e.email});case"iframe":return this.auth.loginWithModal();case"passkey":{if(e.type==="sign-up"){const i=await ue({client:this.wallet.client,ecosystem:this.wallet.ecosystem,authenticatorType:e.authenticatorType,username:e.passkeyName});return this.auth.loginWithAuthToken(i)}const a=await de({client:this.wallet.client,ecosystem:this.wallet.ecosystem,authenticatorType:e.authenticatorType});return this.auth.loginWithAuthToken(a)}default:W(t)}}async logout(){return await this.auth.logout()}}function W(r,e){throw new Error(e??`Invalid param: ${r}`)}export{ye as InAppWebConnector};
