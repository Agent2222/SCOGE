import{Z as w}from"./index-D97fUPyT.js";import{bj as c,bH as y,bX as u,bM as f,ci as g,bo as i,bY as b}from"./main-eIJD23Y3.js";import"./bundler-ZybAzx_f.js";import"./send-eip712-transaction-BPgcI1qG.js";import"./eth_sendRawTransaction-DPdnXbFR.js";import"./concat-hex-C_U9-vzb.js";import"./wScoge-BthgsBuw.js";import"./random-EutHvk_u.js";const d=0n;async function l({account:a,serializableTransaction:e,transaction:o,gasless:n}){const r=u({address:n.relayerForwarderAddress,chain:o.chain,client:o.client}),s=await f({contract:r,method:"function getNonce(address,uint256) view returns (uint256)",params:[a.address,d]}),p=Math.floor(Date.now()/1e3)+(n.deadlineSeconds??3600),t={from:a.address,to:e.to,token:w,txGas:e.gas,tokenGasPrice:0n,batchId:d,batchNonce:s,deadline:p,data:e.data};if(!t.to)throw new Error("Cannot send a transaction without a `to` address");if(!t.txGas)throw new Error("Cannot send a transaction without a `gas` value");if(!t.data)throw new Error("Cannot send a transaction without a `data` value");const h=g([{type:"address"},{type:"address"},{type:"address"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"bytes32"}],[i(t.from),i(t.to),i(t.token),t.txGas,t.tokenGasPrice,t.batchId,t.batchNonce,b(t.data)]),m=await a.signMessage({message:h});return[t,m]}async function I(a){const[e,o]=await l(a),n=await fetch("https://api.biconomy.io/api/v2/meta-tx/native",{method:"POST",body:c({apiId:a.gasless.apiId,params:[e,o],from:e.from,to:e.to,gasLimit:e.txGas}),headers:{"x-api-key":a.gasless.apiKey,"Content-Type":"application/json;charset=utf-8"}});if(!n.ok)throw new Error(`Failed to send transaction: ${await n.text()}`);const r=await n.json(),s=r.txHash;if(y(s))return{transactionHash:s,chain:a.transaction.chain,client:a.transaction.client};throw new Error(`Failed to send transaction: ${c(r)}`)}export{l as prepareBiconomyTransaction,I as relayBiconomyTransaction};
