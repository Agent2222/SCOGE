const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D97fUPyT.js","assets/main-eIJD23Y3.js","assets/wScoge-BthgsBuw.js","assets/wScoge-CUf-lIoi.css","assets/main-CU5_KOYG.css","assets/bundler-ZybAzx_f.js","assets/send-eip712-transaction-BPgcI1qG.js","assets/eth_sendRawTransaction-DPdnXbFR.js","assets/concat-hex-C_U9-vzb.js","assets/random-EutHvk_u.js"])))=>i.map(i=>d[i]);
import{bl as w,bX as T,bo as f,c3 as C,c4 as P,be as x}from"./main-eIJD23Y3.js";import{s as M}from"./types-DlKe2M91.js";import{p as E,o as _,m as W,t as F,n as L}from"./bundler-ZybAzx_f.js";import{r as b}from"./random-EutHvk_u.js";import"./wScoge-BthgsBuw.js";const z="0x3f707e6b",D=[{type:"tuple[]",name:"calls",components:[{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}]}],S=[];function G(n){const t=_(async()=>"asyncParams"in n?await n.asyncParams():n);return E({contract:n.contract,method:[z,D,S],params:async()=>[(await t()).calls],value:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.value},accessList:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.accessList},gas:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.gas},gasPrice:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.gasPrice},maxFeePerGas:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.maxFeePerGas},maxPriorityFeePerGas:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.maxPriorityFeePerGas},nonce:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.nonce},extraGas:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.extraGas},erc20Value:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.erc20Value},authorizationList:async()=>{var a;return(a=(await t()).overrides)==null?void 0:a.authorizationList}})}const A="0xbaC7e770af15d130Cd72838ff386f14FBF3e9a3D",N=n=>{const{client:t,adminAccount:a,sponsorGas:s}=n,c=async e=>{var y;const i=e[0];if(!i)throw new Error("No transactions provided");const o=w(i.chainId),d=T({address:a.address,client:t,chain:o});let h;if(!await R(d)){const u=i.nonce?BigInt(i.nonce)+(s?0n:1n):0n,l=await((y=a.signAuthorization)==null?void 0:y.call(a,{address:A,chainId:i.chainId,nonce:u}));if(!l)throw new Error("Failed to sign authorization");h=l}if(s){const u={calls:e.map(m=>({target:f(m.to??""),value:m.value??0n,data:m.data??"0x"})),uid:b()},l=await a.signTypedData({domain:{name:"MinimalAccount",version:"1",chainId:i.chainId,verifyingContract:d.address},types:{WrappedCalls:[{name:"calls",type:"Call[]"},{name:"uid",type:"bytes32"}],Call:[{name:"target",type:"address"},{name:"value",type:"uint256"},{name:"data",type:"bytes"}]},message:u,primaryType:"WrappedCalls"}),I=await W({eoaAddress:f(a.address),wrappedCalls:u,signature:l,authorization:h,options:{client:t,chain:w(i.chainId)}});return{transactionHash:await H({options:{client:t,chain:w(i.chainId)},transactionId:I.transactionId})}}const p=G({contract:d,calls:e.map(u=>({target:u.to??"",value:u.value??0n,data:u.data??"0x"})),overrides:{value:e.reduce((u,l)=>u+(l.value??0n),0n),authorizationList:h?[h]:void 0}}),v=await F({transaction:p,from:a.address});return a.sendTransaction(v)};return{address:a.address,sendTransaction:async e=>c([e]),sendBatchTransaction:async e=>c(e),signMessage:({message:e,originalMessage:i,chainId:o})=>a.signMessage({message:e,originalMessage:i,chainId:o}),signTypedData:e=>a.signTypedData(e)}};async function R(n){const t=await C(n),a=t.length>0&&t.startsWith("0xef0100"),s=`0x${t.slice(8,48)}`;return a&&s.toLowerCase()===A.toLowerCase()}async function H(n){const t=n.timeoutMs||12e4,a=n.intervalMs||1e3,s=Date.now()+t;for(;Date.now()<s;){const c=await L({options:n.options,transactionId:n.transactionId});if(c.transactionHash)return c.transactionHash;await new Promise(r=>setTimeout(r,a))}throw new Error(`Timeout waiting for transaction to be mined on chain ${n.options.chain.id} with transactionId: ${n.transactionId}`)}async function J(n,t,a){var r,e,i,o;if(((r=t==null?void 0:t.auth)==null?void 0:r.mode)!=="popup"&&((e=t==null?void 0:t.auth)==null?void 0:e.mode)!==void 0&&a.authenticateWithRedirect){const d=n.strategy;M.includes(d)&&await a.authenticateWithRedirect(d,(i=t==null?void 0:t.auth)==null?void 0:i.mode,(o=t==null?void 0:t.auth)==null?void 0:o.redirectUrl)}const c=(await a.connect(n)).user.account;return g({client:n.client,authAccount:c,createOptions:t,desiredChain:n.chain})}async function K(n,t,a){n.authResult&&a.loginWithAuthToken&&await a.loginWithAuthToken(n.authResult);const s=await B(a);if(!s)throw new Error("Failed to authenticate user.");const c=s.account;return g({client:n.client,authAccount:c,createOptions:t,desiredChain:n.chain})}async function U(n){const{connectSmartAccount:t}=await x(async()=>{const{connectSmartAccount:a}=await import("./index-D97fUPyT.js").then(s=>s.i);return{connectSmartAccount:a}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));return t({client:n.client,personalAccount:n.authAccount,chain:n.chain},n.smartAccountOptions)}async function B(n){const t=await n.getUser();switch(t.status){case"Logged In, Wallet Initialized":return t}}async function g(n){const{createOptions:t,authAccount:a,desiredChain:s,client:c}=n;let r,e;const i=t&&"executionMode"in t?t.executionMode:void 0;if(i&&(i.mode==="EIP4337"?r=i.smartAccount:i.mode==="EIP7702"&&(e=i)),t&&"smartAccount"in t&&(t!=null&&t.smartAccount)&&(r=t.smartAccount),r){const[o,d]=await U({client:c,authAccount:a,smartAccountOptions:r,chain:s});return{account:o,chain:d,adminAccount:a}}if(e){const o=s;if(!o)throw new Error("Chain is required for EIP-7702 execution, pass a chain when connecting the inAppWallet.");return{account:N({client:c,adminAccount:a,sponsorGas:e.sponsorGas}),chain:o,adminAccount:a}}return{account:a,chain:s||P}}export{K as autoConnectInAppWallet,J as connectInAppWallet};
