const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/send-eip712-transaction-B6jxAzMB.js","assets/eth_sendRawTransaction-DPdnXbFR.js","assets/main-CBGfwRJF.js","assets/wScoge-BthgsBuw.js","assets/wScoge-CUf-lIoi.css","assets/main-CU5_KOYG.css","assets/concat-hex-CkpDWqfi.js","assets/bundler-BhVJwlN_.js","assets/send-gasless-transaction-CbiXeYJT.js","assets/random-CGsbzoB4.js","assets/decimals-CsRv5sUu.js","assets/signing-D2LUF9h0.js"])))=>i.map(i=>d[i]);
import{be as S,bL as pt,bH as K,bw as W,bM as x,bN as j,bO as C,bP as L,bQ as O,bR as Z,bS as D,bC as yt,bj as Y,bT as b,bU as H,bV as lt,bW as ft,bX as P,bY as wt,bZ as ht,bG as At,b_ as gt,b$ as Q,c0 as X,c1 as Tt,c2 as Gt,bo as J,bs as vt,bl as F,by as E}from"./main-CBGfwRJF.js";import{t as tt,p as _,o as et,a as Pt,b as at,h as xt,e as M,r as V,g as Lt,c as Ot,d as Dt,f as bt,i as U,j as St,k as Ct,l as _t}from"./bundler-BhVJwlN_.js";import{t as Ft,p as Et,s as Vt}from"./send-eip712-transaction-B6jxAzMB.js";import{r as Ut}from"./random-CGsbzoB4.js";const nt="0x0000000000000000000000000000000000000000";function It(e){const a=new Set;let t=e;const i=()=>{for(const r of a)r()};return{getValue(){return t},setValue(r){r!==t&&(t=r,i())},subscribe(r){return a.add(r),()=>{a.delete(r)}}}}const N=new Map;function $t(e){const a=N.get(e);if(a)return a;const t=It([]);return N.set(e,t),t}function Nt(e){const{address:a,transactionHash:t,chainId:i}=e,r=$t(a);r.setValue([...r.getValue(),{transactionHash:t,chainId:i}]),N.set(a,r)}async function Rt(e){let{account:a,transaction:t,gasless:i}=e;if(a.onTransactionRequested&&await a.onTransactionRequested(t),t.eip712){const{sendEip712Transaction:c}=await S(async()=>{const{sendEip712Transaction:s}=await import("./send-eip712-transaction-B6jxAzMB.js").then(o=>o.a);return{sendEip712Transaction:s}},__vite__mapDeps([0,1,2,3,4,5,6,7]));return c({account:a,transaction:t})}const r=await tt({transaction:t,from:a});if(i){const{sendGaslessTransaction:c}=await S(async()=>{const{sendGaslessTransaction:s}=await import("./send-gasless-transaction-CbiXeYJT.js");return{sendGaslessTransaction:s}},__vite__mapDeps([8,2,3,4,5,7,0,1,6,9]));return c({account:a,transaction:t,serializableTransaction:r,gasless:i})}const n=await a.sendTransaction(r);return Nt({address:a.address,transactionHash:n.transactionHash,chainId:t.chain.id}),{...n,chain:t.chain,client:t.client}}async function kt(e){const{factoryContract:a,predictAddressOverride:t,adminAddress:i,accountSalt:r,accountAddress:n}=e;if(t)return t(a,i);if(n)return n;if(!i)throw new Error("Account address is required to predict the smart wallet address.");return pt(async()=>{const c=r&&K(r)?r:W(r??"");let s,o=0;const u=3;for(;o<=u;)try{s=await x({contract:a,method:"function getAddress(address, bytes) returns (address)",params:[i,c]});break}catch(y){if(o===u)throw y;const l=2**(o+1)*200;await new Promise(d=>setTimeout(d,l)),o++}if(!s)throw new Error(`No smart account address found for admin address ${i} and salt ${r}`);return s},{cacheKey:`${e.factoryContract.chain.id}-${e.factoryContract.address}-${e.adminAddress}-${e.accountSalt}`,cacheTime:1e3*60*60*24})}function st(e){const{adminAddress:a,factoryContract:t,createAccountOverride:i,accountSalt:r}=e;if(i)return i(t,a);const n=r&&K(r)?r:W(r??"");return _({contract:t,method:"function createAccount(address, bytes) returns (address)",params:[a,n]})}function rt(e){const{accountContract:a,transaction:t,executeOverride:i}=e;if(i)return i(a,t);let r=t.value||0n;return(t.chainId===295||t.chainId===296)&&(r=BigInt(r)/BigInt(10**10)),_({contract:a,method:"function execute(address, uint256, bytes)",params:[t.to||"",r,t.data||"0x"],gas:t.gas?t.gas+21000n:void 0})}function Ht(e){var c;const{accountContract:a,transactions:t,executeBatchOverride:i}=e;if(i)return i(a,t);let r=t.map(s=>s.value||0n);const n=(c=t[0])==null?void 0:c.chainId;return(n===295||n===296)&&(r=r.map(s=>BigInt(s)/BigInt(10**10))),_({contract:a,method:"function executeBatch(address[], uint256[], bytes[])",params:[t.map(s=>s.to||""),r,t.map(s=>s.data||"0x")]})}const Mt="0xdd62ed3e",Bt=[{type:"address",name:"owner"},{type:"address",name:"spender"}],qt=[{type:"uint256"}];async function zt(e){return x({contract:e.contract,method:[Mt,Bt,qt],params:[e.owner,e.spender]})}const Kt="0x095ea7b3",Wt=[{type:"address",name:"spender"},{type:"uint256",name:"value"}],jt=[{type:"bool"}];function Zt(e){const a=et(async()=>"asyncParams"in e?await e.asyncParams():e);return _({contract:e.contract,method:[Kt,Wt,jt],params:async()=>{const t=await a();return[t.spender,t.value]},value:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.value},accessList:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.accessList},gas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.gas},gasPrice:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.gasPrice},maxFeePerGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.maxFeePerGas},maxPriorityFeePerGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.maxPriorityFeePerGas},nonce:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.nonce},extraGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.extraGas},erc20Value:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.erc20Value},authorizationList:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.authorizationList}})}function Yt(e){return Zt({contract:e.contract,asyncParams:async()=>{let a;if("amount"in e){const{decimals:t}=await S(async()=>{const{decimals:r}=await import("./decimals-CsRv5sUu.js");return{decimals:r}},__vite__mapDeps([10,2,3,4,5])),i=await t(e).catch(()=>18);a=Pt(e.amount.toString(),i)}else a=e.amountWei;return{spender:e.spender,value:a,overrides:{erc20Value:{amountWei:a,tokenAddress:e.contract.address}}}}})}const Qt="0xf15d424e",Xt=[{type:"address",name:"signer"}],Jt=[{type:"tuple",name:"permissions",components:[{type:"address",name:"signer"},{type:"address[]",name:"approvedTargets"},{type:"uint256",name:"nativeTokenLimitPerTransaction"},{type:"uint128",name:"startTimestamp"},{type:"uint128",name:"endTimestamp"}]}];async function te(e){return x({contract:e.contract,method:[Qt,Xt,Jt],params:[e.signer]})}const ee="0x5892e236",ae=[{type:"tuple",name:"req",components:[{type:"address",name:"signer"},{type:"uint8",name:"isAdmin"},{type:"address[]",name:"approvedTargets"},{type:"uint256",name:"nativeTokenLimitPerTransaction"},{type:"uint128",name:"permissionStartTimestamp"},{type:"uint128",name:"permissionEndTimestamp"},{type:"uint128",name:"reqValidityStartTimestamp"},{type:"uint128",name:"reqValidityEndTimestamp"},{type:"bytes32",name:"uid"}]},{type:"bytes",name:"signature"}],ne=[];function se(e){const a=et(async()=>"asyncParams"in e?await e.asyncParams():e);return _({contract:e.contract,method:[ee,ae,ne],params:async()=>{const t=await a();return[t.req,t.signature]},value:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.value},accessList:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.accessList},gas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.gas},gasPrice:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.gasPrice},maxFeePerGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.maxFeePerGas},maxPriorityFeePerGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.maxPriorityFeePerGas},nonce:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.nonce},extraGas:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.extraGas},erc20Value:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.erc20Value},authorizationList:async()=>{var t;return(t=(await a()).overrides)==null?void 0:t.authorizationList}})}function z(){return new Date(Date.now()+1e3*60*60*24*365*10)}function $(e){return Ft(Math.floor(e.getTime()/1e3))}const re=[{name:"signer",type:"address"},{name:"isAdmin",type:"uint8"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"permissionStartTimestamp",type:"uint128"},{name:"permissionEndTimestamp",type:"uint128"},{name:"reqValidityStartTimestamp",type:"uint128"},{name:"reqValidityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}];async function ie(e){const{account:a,contract:t,req:i}=e,r=await a.signTypedData({domain:{name:"Account",version:"1",verifyingContract:t.address,chainId:t.chain.id},primaryType:"SignerPermissionRequest",types:{SignerPermissionRequest:re},message:i});return{req:i,signature:r}}async function ce(e){var i;const{target:a,permissions:t}=e;return{approvedTargets:t.approvedTargets==="*"?[nt]:t.approvedTargets,nativeTokenLimitPerTransaction:at(((i=t.nativeTokenLimitPerTransaction)==null?void 0:i.toString())||"0"),permissionStartTimestamp:$(t.permissionStartTimestamp||new Date(0)),permissionEndTimestamp:$(t.permissionEndTimestamp||z()),reqValidityStartTimestamp:0n,reqValidityEndTimestamp:$(z()),uid:await Ut(),isAdmin:0,signer:a}}function oe(e){const{contract:a,sessionKeyAddress:t,account:i,permissions:r}=e;return se({contract:a,async asyncParams(){const{req:n,signature:c}=await ie({account:i,contract:a,req:await ce({target:t,permissions:r})});return{signature:c,req:n}}})}async function de(e){var c;const{accountContract:a,sessionKeyAddress:t,newPermissions:i}=e;if(!await j(a))return!0;const n=await te({contract:a,signer:t});return!!(n.endTimestamp&&n.endTimestamp<Math.floor(new Date().getTime()/1e3)||!me(n.approvedTargets,i.approvedTargets)||at(((c=i.nativeTokenLimitPerTransaction)==null?void 0:c.toString())??"0")>n.nativeTokenLimitPerTransaction)}function me(e,a){return a==="*"&&e.length===1&&e[0]===nt?!0:a!=="*"?a.map(t=>t.toLowerCase()).every(t=>e.map(i=>i.toLowerCase()).includes(t)):!1}const ue=2n**96n-1n,pe="0x35567e1a",ye=[{type:"address",name:"sender"},{type:"uint192",name:"key"}],le=[{type:"uint256",name:"nonce"}];async function fe(e){return x({contract:e.contract,method:[pe,ye,le],params:[e.sender,e.key]})}const we="0xa6193531",he=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"uint256",name:"callGasLimit"},{type:"uint256",name:"verificationGasLimit"},{type:"uint256",name:"preVerificationGas"},{type:"uint256",name:"maxFeePerGas"},{type:"uint256",name:"maxPriorityFeePerGas"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],Ae=[{type:"bytes32"}];async function ge(e){return x({contract:e.contract,method:[we,he,Ae],params:[e.userOp]})}const Te="0x22cdde4c",Ge=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"bytes32",name:"accountGasLimits"},{type:"uint256",name:"preVerificationGas"},{type:"bytes32",name:"gasFees"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],ve=[{type:"bytes32"}];async function Pe(e){return x({contract:e.contract,method:[Te,Ge,ve],params:[e.userOp]})}function xe(e){return e.factory?C([e.factory,e.factoryData||"0x"]):"0x"}function Le(e){return C([L(O(BigInt(e.verificationGasLimit)),{size:16}),L(O(BigInt(e.callGasLimit)),{size:16})])}function Oe(e){return C([L(O(BigInt(e.maxPriorityFeePerGas)),{size:16}),L(O(BigInt(e.maxFeePerGas)),{size:16})])}function De(e){return e.paymaster?C([e.paymaster,L(O(BigInt(e.paymasterVerificationGasLimit||0)),{size:16}),L(O(BigInt(e.paymasterPostOpGasLimit||0)),{size:16}),e.paymasterData||"0x"]):"0x"}const be=e=>({sender:e.sender,nonce:BigInt(e.nonce),initCode:xe(e),callData:e.callData,accountGasLimits:Le(e),preVerificationGas:BigInt(e.preVerificationGas),gasFees:Oe(e),paymasterAndData:De(e),signature:e.signature});async function I(e){var A;const{userOp:a,paymasterOverride:t,client:i,chain:r,entrypointAddress:n}=e;if(t)return t(a);const c={"Content-Type":"application/json"},s=n??D,o=Z(r),u={jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[xt(a),s]},l=await yt(i)(o,{method:"POST",headers:c,body:Y(u)});if(!l.ok){const g=await l.text()||l.statusText;throw new Error(`Paymaster error: ${l.status} - ${g}`)}const d=await l.json();if(d.result)return typeof d.result=="string"?{paymasterAndData:d.result}:(d.result.reason&&console.warn(`Paymaster policy rejected this transaction with reason: ${d.result.reason} ${d.result.policyId?`(policyId: ${d.result.policyId})`:""}`),{paymasterAndData:d.result.paymasterAndData,verificationGasLimit:d.result.verificationGasLimit?b(d.result.verificationGasLimit):void 0,preVerificationGas:d.result.preVerificationGas?b(d.result.preVerificationGas):void 0,callGasLimit:d.result.callGasLimit?b(d.result.callGasLimit):void 0,paymaster:d.result.paymaster,paymasterData:d.result.paymasterData,paymasterVerificationGasLimit:d.result.paymasterVerificationGasLimit?b(d.result.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:d.result.paymasterPostOpGasLimit?b(d.result.paymasterPostOpGasLimit):void 0});const h=((A=d.error)==null?void 0:A.message)||d.error||l.statusText||"unknown error";throw new Error(`Paymaster error from ${o}: ${h}`)}const B=new Set,q=e=>`${e.chain.id}:${e.address}`,it=e=>{B.add(q(e))},ct=e=>{B.delete(q(e))},ot=e=>B.has(q(e));async function Se(e){const a=e.timeoutMs||12e4,t=e.intervalMs||1e3,i=Date.now()+a;for(;Date.now()<i;){const r=await Lt(e);if(r)return r;await new Promise(n=>setTimeout(n,t))}throw new Error(`Timeout waiting for userOp to be mined on chain ${e.chain.id} with UserOp hash: ${e.userOpHash}`)}async function Ce(e){var w;const{transaction:a,accountContract:t,factoryContract:i,adminAddress:r,overrides:n,sponsorGas:c,waitForDeployment:s=!0,isDeployedOverride:o}=e,u=a.chain,y=a.client,l={client:y,chain:u,bundlerUrl:n==null?void 0:n.bundlerUrl,entrypointAddress:n==null?void 0:n.entrypointAddress},d=H(((w=e.overrides)==null?void 0:w.entrypointAddress)||D),[h,A,g,T,f]=await Promise.all([typeof o=="boolean"?o:j(t).then(G=>G||ot(t)),M(a),V(a.gas),_e({executeTx:a,bundlerOptions:l,chain:u,client:y}),$e({accountContract:t,chain:u,client:y,entrypointAddress:n==null?void 0:n.entrypointAddress,getNonceOverride:n==null?void 0:n.getAccountNonce})]),{maxFeePerGas:m,maxPriorityFeePerGas:p}=T;return d==="v0.7"?Fe({bundlerOptions:l,factoryContract:i,accountContract:t,adminAddress:r,sponsorGas:c,overrides:n,isDeployed:h,nonce:f,callData:A,callGasLimit:g,maxFeePerGas:m,maxPriorityFeePerGas:p,waitForDeployment:s}):Ee({bundlerOptions:l,factoryContract:i,accountContract:t,adminAddress:r,sponsorGas:c,overrides:n,isDeployed:h,nonce:f,callData:A,callGasLimit:g,maxFeePerGas:m,maxPriorityFeePerGas:p,waitForDeployment:s})}async function _e(e){const{executeTx:a,bundlerOptions:t,chain:i,client:r}=e;let{maxFeePerGas:n,maxPriorityFeePerGas:c}=a;const s=(t==null?void 0:t.bundlerUrl)??Z(i);if(ft(s)){const o=await Ot({options:t});n=o.maxFeePerGas,c=o.maxPriorityFeePerGas}else{const[o,u]=await Promise.all([V(n),V(c)]);if(o&&u)n=o,c=u;else{const y=await Dt(r,i);c=u??y.maxPriorityFeePerGas??0n,n=o??y.maxFeePerGas??0n}}return{maxFeePerGas:n,maxPriorityFeePerGas:c}}async function Fe(e){const{bundlerOptions:a,isDeployed:t,factoryContract:i,accountContract:r,adminAddress:n,sponsorGas:c,overrides:s,nonce:o,callData:u,callGasLimit:y,maxFeePerGas:l,maxPriorityFeePerGas:d,waitForDeployment:h}=e,{chain:A,client:g}=a;let T,f;t?(f="0x",h&&await dt(r)):(T=i.address,f=await M(st({factoryContract:i,adminAddress:n,accountSalt:s==null?void 0:s.accountSalt,createAccountOverride:s==null?void 0:s.createAccount})),h&&it(r));const m={sender:r.address,nonce:o,callData:u,maxFeePerGas:l,maxPriorityFeePerGas:d,callGasLimit:y??0n,verificationGasLimit:0n,preVerificationGas:0n,factory:T,factoryData:f,paymaster:void 0,paymasterData:"0x",paymasterVerificationGasLimit:0n,paymasterPostOpGasLimit:0n,signature:Q};if(c){const p=await I({userOp:m,chain:A,client:g,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster});if(p.paymaster&&p.paymasterData&&(m.paymaster=p.paymaster,m.paymasterData=p.paymasterData),p.callGasLimit&&p.verificationGasLimit&&p.preVerificationGas&&p.paymasterPostOpGasLimit&&p.paymasterVerificationGasLimit)m.callGasLimit=p.callGasLimit,m.verificationGasLimit=p.verificationGasLimit,m.preVerificationGas=p.preVerificationGas,m.paymasterPostOpGasLimit=p.paymasterPostOpGasLimit,m.paymasterVerificationGasLimit=p.paymasterVerificationGasLimit;else{const w=s!=null&&s.tokenPaymaster?{[s.tokenPaymaster.tokenAddress]:{stateDiff:{[wt(ht([{type:"address"},{type:"uint256"}],[r.address,s.tokenPaymaster.balanceStorageSlot]))]:At(gt,{size:32})}}}:void 0,G=await U({userOp:m,options:a},w);m.callGasLimit=G.callGasLimit,m.verificationGasLimit=G.verificationGasLimit,m.preVerificationGas=G.preVerificationGas,m.paymasterPostOpGasLimit=s!=null&&s.tokenPaymaster?500000n:G.paymasterPostOpGasLimit||0n,m.paymasterVerificationGasLimit=G.paymasterVerificationGasLimit||0n;const v=await I({userOp:m,chain:A,client:g,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster});v.paymaster&&v.paymasterData&&(m.paymaster=v.paymaster,m.paymasterData=v.paymasterData)}}else{const p=await U({userOp:m,options:a});m.callGasLimit=p.callGasLimit,m.verificationGasLimit=p.verificationGasLimit,m.preVerificationGas=p.preVerificationGas,m.paymasterPostOpGasLimit=p.paymasterPostOpGasLimit||0n,m.paymasterVerificationGasLimit=p.paymasterVerificationGasLimit||0n}return{...m,signature:"0x"}}async function Ee(e){const{bundlerOptions:a,isDeployed:t,factoryContract:i,accountContract:r,adminAddress:n,sponsorGas:c,overrides:s,nonce:o,callData:u,callGasLimit:y,maxFeePerGas:l,maxPriorityFeePerGas:d,waitForDeployment:h}=e,{chain:A,client:g}=a;let T;t?(T="0x",h&&await dt(r)):(T=await Ie({factoryContract:i,adminAddress:n,accountSalt:s==null?void 0:s.accountSalt,createAccountOverride:s==null?void 0:s.createAccount}),h&&it(r));const f={sender:r.address,nonce:o,initCode:T,callData:u,maxFeePerGas:l,maxPriorityFeePerGas:d,callGasLimit:y??0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:Q};if(c){const m=await I({userOp:f,chain:A,client:g,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster}),p="paymasterAndData"in m?m.paymasterAndData:"0x";if(p&&p!=="0x"&&(f.paymasterAndData=p),m.callGasLimit&&m.verificationGasLimit&&m.preVerificationGas)f.callGasLimit=m.callGasLimit,f.verificationGasLimit=m.verificationGasLimit,f.preVerificationGas=m.preVerificationGas;else{const w=await U({userOp:f,options:a});if(f.callGasLimit=w.callGasLimit,f.verificationGasLimit=w.verificationGasLimit,f.preVerificationGas=w.preVerificationGas,p&&p!=="0x"){const G=await I({userOp:f,chain:A,client:g,entrypointAddress:s==null?void 0:s.entrypointAddress,paymasterOverride:s==null?void 0:s.paymaster}),v="paymasterAndData"in G?G.paymasterAndData:"0x";v&&v!=="0x"&&(f.paymasterAndData=v)}}}else{const m=await U({userOp:f,options:a});f.callGasLimit=m.callGasLimit,f.verificationGasLimit=m.verificationGasLimit,f.preVerificationGas=m.preVerificationGas}return{...f,signature:"0x"}}async function Ve(e){const{userOp:a,chain:t,entrypointAddress:i,adminAccount:r}=e,n=await Ue({client:e.client,userOp:a,chain:t,entrypointAddress:i});if(r.signMessage){const c=await r.signMessage({message:{raw:lt(n)},originalMessage:Y(a),chainId:t.id});return{...a,signature:c}}throw new Error("signMessage not implemented in signingAccount")}async function Ue(e){const{userOp:a,chain:t,entrypointAddress:i}=e,r=H(i||D);let n;if(r==="v0.7"){const c=be(a);n=await Pe({contract:P({address:i||X,chain:t,client:e.client}),userOp:c})}else n=await ge({contract:P({address:i||D,chain:t,client:e.client}),userOp:a});return n}async function Ie(e){const{factoryContract:a,adminAddress:t,accountSalt:i,createAccountOverride:r}=e,n=st({factoryContract:a,adminAddress:t,accountSalt:i,createAccountOverride:r});return C([a.address,await M(n)])}async function $e(e){const{accountContract:a,chain:t,client:i,entrypointAddress:r,getNonceOverride:n}=e;return n?n(a):await fe({contract:P({address:r||D,chain:t,client:i}),key:bt(),sender:a.address})}async function dt(e){const a=Date.now();for(;ot(e);){if(Date.now()-a>6e4)throw ct(e),new Error("Account deployment is taking too long (over 1 minute). Please try again.");await new Promise(t=>setTimeout(t,500))}}const mt=new WeakMap,R=new WeakMap;async function Ne(e,a){var h,A,g,T,f,m,p;const{personalAccount:t,client:i,chain:r}=e;if(!t)throw new Error("No personal account provided for smart account connection");const n=a,c=r??n.chain,s="gasless"in n?n.gasless:n.sponsorGas;if(await Tt(c))return[Me({creationOptions:a,connectionOptions:e,chain:c,sponsorGas:s}),c];if(n.factoryAddress&&!((h=n.overrides)!=null&&h.entrypointAddress)){const w=await ut(n.factoryAddress,i,c);w&&(n.overrides={...n.overrides,entrypointAddress:w})}(A=n.overrides)!=null&&A.tokenPaymaster&&!((g=n.overrides)!=null&&g.entrypointAddress)&&(n.overrides={...n.overrides,entrypointAddress:X});const o=n.factoryAddress??Gt((T=n.overrides)==null?void 0:T.entrypointAddress),u=P({client:i,address:o,chain:c}),y=await kt({factoryContract:u,adminAddress:t.address,predictAddressOverride:(f=n.overrides)==null?void 0:f.predictAddress,accountSalt:(m=n.overrides)==null?void 0:m.accountSalt,accountAddress:(p=n.overrides)==null?void 0:p.accountAddress}).then(w=>w).catch(w=>{throw new Error(`Failed to get account address with factory contract ${u.address} on chain ID ${c.id}: ${(w==null?void 0:w.message)||"unknown error"}`,{cause:w})}),l=P({client:i,address:y,chain:c}),d=await ke({...n,chain:c,sponsorGas:s,personalAccount:t,accountContract:l,factoryContract:u,client:i});if(mt.set(t,d),R.set(d,t),n.sessionKey&&await de({accountContract:l,sessionKeyAddress:n.sessionKey.address,newPermissions:n.sessionKey.permissions})){const w=oe({account:t,contract:l,permissions:n.sessionKey.permissions,sessionKeyAddress:n.sessionKey.address});await Rt({account:d,transaction:w})}return[d,c]}async function Re(e){const a=R.get(e);a&&(mt.delete(a),R.delete(e))}async function ke(e){var r,n;const a=(r=e.overrides)==null?void 0:r.tokenPaymaster;if(a&&H(((n=e.overrides)==null?void 0:n.entrypointAddress)||D)!=="v0.7")throw new Error("Token paymaster is only supported for entrypoint version v0.7");let t=e.accountContract;const i={address:J(t.address),async sendTransaction(c){var l,d,h;let s;if(a){await He({accountContract:t,erc20Paymaster:a,options:e});const A=async()=>({paymaster:a.paymasterAddress,paymasterData:"0x"});s=((l=e.overrides)==null?void 0:l.paymaster)||A}else s=(d=e.overrides)==null?void 0:d.paymaster;c.chainId!==t.chain.id&&(t=P({address:i.address,chain:F(c.chainId),client:e.client}));const o=rt({accountContract:t,transaction:c,executeOverride:(h=e.overrides)==null?void 0:h.execute}),u=F(c.chainId),y=await k({executeTx:o,options:{...e,chain:u,accountContract:t,overrides:{...e.overrides,paymaster:s}}});return E({client:e.client,chainId:u.id,transactionHash:y.transactionHash,walletAddress:e.accountContract.address,walletType:"smart",contractAddress:c.to??void 0}),y},async sendBatchTransaction(c){var l,d;const s=Ht({accountContract:t,transactions:c,executeBatchOverride:(l=e.overrides)==null?void 0:l.executeBatch});if(c.length===0)throw new Error("No transactions to send");const o=c[0];if(!o)throw new Error("No transactions to send");const u=F(o.chainId),y=await k({executeTx:s,options:{...e,chain:u,accountContract:t}});return E({client:e.client,chainId:u.id,transactionHash:y.transactionHash,walletAddress:e.accountContract.address,walletType:"smart",contractAddress:((d=c[0])==null?void 0:d.to)??void 0}),y},async signMessage({message:c}){var o;if((o=e.overrides)!=null&&o.signMessage)return e.overrides.signMessage({adminAccount:e.personalAccount,factoryContract:e.factoryContract,accountContract:t,message:c});const{smartAccountSignMessage:s}=await S(async()=>{const{smartAccountSignMessage:u}=await import("./signing-D2LUF9h0.js");return{smartAccountSignMessage:u}},__vite__mapDeps([11,2,3,4,5,6,7,0,1,9]));return s({accountContract:t,factoryContract:e.factoryContract,options:e,message:c})},async signTypedData(c){var o;if((o=e.overrides)!=null&&o.signTypedData)return e.overrides.signTypedData({adminAccount:e.personalAccount,factoryContract:e.factoryContract,accountContract:t,typedData:c});const{smartAccountSignTypedData:s}=await S(async()=>{const{smartAccountSignTypedData:u}=await import("./signing-D2LUF9h0.js");return{smartAccountSignTypedData:u}},__vite__mapDeps([11,2,3,4,5,6,7,0,1,9]));return s({accountContract:t,factoryContract:e.factoryContract,options:e,typedData:c})},async onTransactionRequested(c){var s,o;return(o=(s=e.personalAccount).onTransactionRequested)==null?void 0:o.call(s,c)}};return i}async function He(e){var y;const{accountContract:a,erc20Paymaster:t,options:i}=e,r=t.tokenAddress,n=P({address:r,chain:a.chain,client:a.client});if(await zt({contract:n,owner:a.address,spender:t.paymasterAddress})>0n)return;const s=Yt({contract:n,spender:t.paymasterAddress,amountWei:ue-1n}),o=await tt({transaction:s,from:a.address}),u=rt({accountContract:a,transaction:o,executeOverride:(y=i.overrides)==null?void 0:y.execute});await k({executeTx:u,options:{...i,overrides:{...i.overrides,tokenPaymaster:void 0}}})}function Me(e){const{creationOptions:a,connectionOptions:t,chain:i}=e,r={address:J(t.personalAccount.address),async sendTransaction(n){var y,l,d,h;const c={data:n.data,to:n.to??void 0,value:n.value??0n,chain:F(n.chainId),client:t.client,eip712:n.eip712};let s=await Et({account:r,transaction:c});if(e.sponsorGas&&!s.paymaster){const A=await St({options:{client:t.client,chain:i,bundlerUrl:(y=a.overrides)==null?void 0:y.bundlerUrl,entrypointAddress:(l=a.overrides)==null?void 0:l.entrypointAddress},transaction:s});s={...s,...A}}const o=await Vt({account:r,chainId:i.id,eip712Transaction:s}),u=await Ct({options:{client:t.client,chain:i,bundlerUrl:(d=a.overrides)==null?void 0:d.bundlerUrl,entrypointAddress:(h=a.overrides)==null?void 0:h.entrypointAddress},transaction:s,signedTransaction:o});return E({client:t.client,chainId:i.id,transactionHash:u.transactionHash,walletAddress:r.address,walletType:"smart",contractAddress:n.to??void 0}),{transactionHash:u.transactionHash,client:t.client,chain:i}},async signMessage({message:n}){return t.personalAccount.signMessage({message:n})},async signTypedData(n){const c=vt(n);return t.personalAccount.signTypedData(c)},async onTransactionRequested(n){var c,s;return(s=(c=t.personalAccount).onTransactionRequested)==null?void 0:s.call(c,n)}};return r}async function k(e){var i,r,n;const{executeTx:a,options:t}=e;try{const c=await Ce({transaction:a,factoryContract:t.factoryContract,accountContract:t.accountContract,adminAddress:t.personalAccount.address,sponsorGas:t.sponsorGas,overrides:t.overrides}),s=await Ve({client:t.client,chain:t.chain,adminAccount:t.personalAccount,entrypointAddress:(i=t.overrides)==null?void 0:i.entrypointAddress,userOp:c}),o={chain:t.chain,client:t.client,bundlerUrl:(r=t.overrides)==null?void 0:r.bundlerUrl,entrypointAddress:(n=t.overrides)==null?void 0:n.entrypointAddress},u=await _t({options:o,userOp:s}),y=await Se({...o,userOpHash:u});return E({client:t.client,chainId:t.chain.id,transactionHash:y.transactionHash,walletAddress:t.accountContract.address,walletType:"smart",contractAddress:await V(a.to??void 0)}),{client:t.client,chain:t.chain,transactionHash:y.transactionHash}}finally{ct(t.accountContract)}}async function ut(e,a,t){const i=P({address:e,client:a,chain:t});try{return await x({contract:i,method:"function entrypoint() public view returns (address)"})}catch{return}}const We=Object.freeze(Object.defineProperty({__proto__:null,connectSmartAccount:Ne,disconnectSmartAccount:Re,getEntrypointFromFactory:ut},Symbol.toStringTag,{value:"Module"}));export{nt as Z,Nt as a,We as i,st as p};
